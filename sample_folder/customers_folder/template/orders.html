{% extends "base.html" %}

{% block head %}
    <title>Crave On - Orders</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/customer/orders.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="bg-container">
    <div class="col-md-8 mx-auto mt-4">
        <div class="cart-container">
            <form id="orderForm" method="POST">
                <div id="orderItemsContainer"></div>
                <div class="border-top pt-2">
                    <p class="total-amount" id="totalAmountText">Total Amount: ₱0</p>
                    <button type="button" class="btn-order" id="proceedPaymentBtn">PROCEED TO PAYMENT</button>
                </div>                    
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("orderItemsContainer");
        const totalAmountText = document.getElementById("totalAmountText");

        // Load cart items from sessionStorage
        const cartItems = JSON.parse(sessionStorage.getItem('cart_items')) || [];
        let total = 0;

        if (cartItems.length === 0) {
            container.innerHTML = "<p>Your order is empty.</p>";
        } else {
            cartItems.forEach((item, index) => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                container.innerHTML += `
                    <div class="cart-item" data-index="${index}">
                        <div class="item-info d-flex align-items-center mb-2">
                            <img class="item-image me-2" src="${item.image_url}" alt="${item.name}" style="width: 60px; height: 60px;">
                            <p>${item.name} - ${item.quantity} x ₱${item.price}</p>
                        </div>
                    </div>`;
            });
        }

        totalAmountText.textContent = `Total Amount: ₱${total}`;
    });

    // Proceed to payment
    document.getElementById('proceedPaymentBtn').addEventListener('click', function () {
        const cartItems = JSON.parse(sessionStorage.getItem('cart_items')) || [];

        if (cartItems.length === 0) {
            alert("Order is empty!");
            return;
        }

        // Redirect to the payment page without saving the order
        window.location.href = "{{ url_for('customer.payment') }}";
    });
</script>
{% endblock %}
