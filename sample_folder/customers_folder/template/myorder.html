{% extends "base.html" %}

{% block head %}
    <title>Crave On - My Orders</title>
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/customer/myorder.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/customer/myorders.css') }}">

{% endblock %}

{% block content %}


<div class="bg-container">

    <div class="col-md-10 mx-auto">
        <div class="orders-container">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Items</th>
                        <th>Quantity</th>
                        <th>Total Amount</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
fetch('/CraveOn/api/myorders')
    .then(response => response.json())
    .then(data => {
        window.ordersData = data;
        updateOrderTable();
    });

function updateOrderTable() {
    let tableBody = document.getElementById("orders-table-body");
    tableBody.innerHTML = "";
    window.ordersData.forEach((order, index) => {
        let row = `<tr onclick="showOrderDetails(${index})" style="cursor:pointer;">
            <td>${order.name}</td>
            <td>${order.items.map(item => item.name).join("<br>")}</td>
            <td>${order.items.map(item => + item.quantity).join("<br>")}</td>
            <td>₱${order.total_amount}</td>
            <td>${order.order_date}</td>
            <td>${order.status}</td>
        </tr>`;
        tableBody.innerHTML += row;
    });
}

function showOrderDetails(index) {
    const order = window.ordersData[index];
    document.getElementById("modalName").textContent = order.name;
    document.getElementById("modalContact").textContent = order.contact;
    document.getElementById("modalAddress").textContent = order.address;
    document.getElementById("modalOrderDate").textContent = order.order_date;
    document.getElementById("modalStatus").textContent = order.status;
    document.getElementById("modalTotalAmount").textContent = order.total_amount;

    const itemsList = document.getElementById("modalItems");
    itemsList.innerHTML = "";
    order.items.forEach(item => {
        itemsList.innerHTML += `<li>${item.name} - ${item.quantity} - ₱${item.price}</li>`;
    });

    document.getElementById("modalPaymentScreenshot").src = order.payment_screenshot;

    let orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
    orderModal.show();
}
</script>
{% endblock %}